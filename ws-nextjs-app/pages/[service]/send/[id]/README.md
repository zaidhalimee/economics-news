# UGC Uploader Form

## Description

User Generated Content (UGC) refers to any content that is generated by the user. Our uploader form supports the following types of UGC: long text, short text, checkbox, e-mail, telephone, files and images.

## BFF Response

A sample BFF response for a given UGC/Send page can be found here:
[BFF Send Response](https://fabl.api.bbci.co.uk/playground?env=production&module=simorgh-bff&params=id=u50853489;true,service=mundo;true,pageType=ugcForm;true&context=ctx-service-env=live)

## How routes are handled

Our UGC Uploader Page is served through the following route:
`/pages/[service]/send/[id]/[[variant]]`, where the double brackets in `[[variant]]` means that the variant is optional.

This route matches the file structure of this repo:

    ├── ws-nextjs-app
        ├── pages
            ├── [service]
                ├── send
                    ├── [id]
    	                ├── [[...variant]].page.tsx
                    ├── [[...]].page.tsx
            ├── _app.page.tsx
            ├── _document.page.tsx

Sample routes that match this construct are:

| Service            | URL                     |
| ------------------ | ----------------------- |
| Mundo (no variant) | `/mundo/send/u50853489` |

#### Server Side functions

Within `[[variant]].page.tsx`, the `getServerSideProps` function is called on the server side when a request to a send page is made. It's important that this function returns an object that directly correlates to the props expected by the default exported component within `[[variant]].page.tsx`.

```
export const getServerSideProps: GetServerSideProps = async context => {

  context.res.statusCode = data.status;

  return {
    props: {
      ...props expected by UGCPageLayout
    },
  };
};

export default UGCPageLayout;
```

In the code snippet above, NextJS will serve the component returned by `UGCPageLayout`. Before doing so, it calls `getServerSideProps` (on the server) to retrieve the requisite props, which are then used to call `UGCPageLayout`, which in turn returns a valid HTML element.

**It's important that request/response data is stored within `context.res`, so that requests can be handled appropriately by our ELBs.**

## Component Structure

A typical UGC form can be found here: https://www.bbc.com/mundo/send/u50853489

Component file structure

    ├── ws-nextjs-app
        ├── pages
            ├── [service]
                ├── send
                    ├── [id]
    	                ├── FormContext
    	                ├── FormScreen
    	                ├── FormField
    		                ├── File
    		                ├── Checkbox
    		                ├── EmailInput
    		                ├── FieldLabel
    		                ├── Telephone
    		                ├── TextArea
    		                ├── TextInput

The FormScreen component takes in a list of fields from the BFF and populates itself with a respective body of form fields, based on the components we have available. This is a sample BFF Response:

For example, if the BFF returned the following under `data.sections.fields`, then it would render a phone field followed by a text area:

    {  "id":  "txt49018963",
       "type":  "text",
       "validation":  {  "mandatory":  false  },
       "htmlType":  "phone",
       "label":  "Número de teléfono",
       "description":  "",
       "textArea":  false
     },
     {  "id":  "txt49019016",
        "type":  "text",
        "validation":  {  "mandatory":  true  },
        "htmlType":  "textarea",
        "label":  "Comentario (obligatorio)",
        "description":  "",
        "textArea":  true
    },

### Form Context

The FormContext acts as controller to collate and send all UGC inputted into the form. The `handleSubmit` function within the FormContext effectively validates the form field values and sends it off to the UGC team.
